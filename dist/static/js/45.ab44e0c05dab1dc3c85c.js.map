{"version":3,"sources":["webpack:///./node_modules/vue-markdown-loader/_cache/eventloop.vue?a801","webpack:///./node_modules/vue-markdown-loader/_cache/eventloop.vue","webpack:///./src/components/posts/js/eventloop.md"],"names":["eventloop","render","this","$createElement","_self","_c","_m","staticRenderFns","_vm","_h","_v","attrs","href","src","alt","staticClass","Component","__webpack_require__","normalizeComponent","__webpack_exports__","module","exports"],"mappings":"sGAAA,IAGeA,GADEC,OAFjB,WAA0BC,KAAaC,eAAbD,KAAuCE,MAAAC,GAAwB,OAA/DH,KAA+DI,GAAA,IAExEC,iBADjB,WAAoC,IAAAC,EAAAN,KAAaO,EAAAD,EAAAL,eAA0BE,EAAAG,EAAAJ,MAAAC,IAAAI,EAAwB,OAAAJ,EAAA,WAAAA,EAAA,KAAAG,EAAAE,GAAA,WAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAA,EAAA,KAA2EM,OAAOC,KAAA,+CAAoDJ,EAAAE,GAAA,iDAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAA,EAAA,KAAsFM,OAAOC,KAAA,+CAAoDJ,EAAAE,GAAA,kEAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,cAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,eAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,2CAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,eAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,qHAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,sCAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,iBAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,gEAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,aAAAL,EAAA,QAAAG,EAAAE,GAAA,gBAAAF,EAAAE,GAAA,KAAAL,EAAA,QAAAG,EAAAE,GAAA,cAAAF,EAAAE,GAAA,KAAAL,EAAA,QAAAG,EAAAE,GAAA,iBAAAF,EAAAE,GAAA,+BAAAL,EAAA,UAAAG,EAAAE,GAAA,cAAAF,EAAAE,GAAA,qBAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,6FAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,6FAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAA,EAAA,UAAAG,EAAAE,GAAA,oBAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,2DAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,0CAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAA,EAAA,OAAq1CM,OAAOE,IAAA,gHAAAC,IAAA,gBAAwIN,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,yBAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,gCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,cAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAA,EAAA,UAAAG,EAAAE,GAAA,YAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,MAAAL,EAAA,KAA0PM,OAAOC,KAAA,oDAAyDJ,EAAAE,GAAA,gDAAoDF,EAAAE,GAAA,yBAAAL,EAAA,UAAAG,EAAAE,GAAA,UAAAF,EAAAE,GAAA,kCAAAF,EAAAE,GAAA,KAAAL,EAAA,OAAAA,EAAA,QAA6IU,YAAA,iBAA2BV,EAAA,QAAaU,YAAA,cAAwBP,EAAAE,GAAA,kBAAAF,EAAAE,GAAA,QAAAL,EAAA,QAAqDU,YAAA,iBAA2BP,EAAAE,GAAA,WAAAF,EAAAE,GAAA,eAAAL,EAAA,QAAqDU,YAAA,kBAA4BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,KAAAL,EAAA,QAA6CU,YAAA,gBAA0BP,EAAAE,GAAA,eAAAF,EAAAE,GAAA,OAAAL,EAAA,QAAiDU,YAAA,iBAA2BP,EAAAE,GAAA,WAAAF,EAAAE,GAAA,kBAAAL,EAAA,QAAwDU,YAAA,kBAA4BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,KAAAL,EAAA,QAA6CU,YAAA,gBAA0BP,EAAAE,GAAA,kBAAAF,EAAAE,GAAA,OAAAL,EAAA,QAAoDU,YAAA,iBAA2BP,EAAAE,GAAA,WAAAF,EAAAE,GAAA,gCAAAL,EAAA,QAAsEU,YAAA,gBAA0BP,EAAAE,GAAA,SAAAF,EAAAE,GAAA,qBAAAL,EAAA,QAAyDU,YAAA,kBAA4BV,EAAA,QAAaU,YAAA,iBAA2BP,EAAAE,GAAA,cAAAF,EAAAE,GAAA,KAAAL,EAAA,QAA8CU,YAAA,eAAyBP,EAAAE,GAAA,gBAAAF,EAAAE,GAAA,KAAAL,EAAA,QAAgDU,YAAA,gBAA0BP,EAAAE,GAAA,cAAAF,EAAAE,GAAA,QAAAF,EAAAE,GAAA,qDAA2FL,EAAA,QAAkBU,YAAA,iBAA2BP,EAAAE,GAAA,WAAAF,EAAAE,GAAA,aAAAL,EAAA,QAAmDU,YAAA,gBAA0BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,MAAAL,EAAA,QAA8CU,YAAA,gBAA0BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,MAAAL,EAAA,QAA8CU,YAAA,gBAA0BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,MAAAL,EAAA,QAA8CU,YAAA,gBAA0BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,MAAAL,EAAA,QAA8CU,YAAA,gBAA0BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,UAAgCL,EAAA,QAAkBU,YAAA,kBAA4BV,EAAA,QAAaU,YAAA,iBAA2BP,EAAAE,GAAA,cAAAF,EAAAE,GAAA,KAAAL,EAAA,QAA8CU,YAAA,eAAyBP,EAAAE,GAAA,kBAAAF,EAAAE,GAAA,KAAAL,EAAA,QAAkDU,YAAA,gBAA0BP,EAAAE,GAAA,cAAAF,EAAAE,GAAA,QAAAF,EAAAE,GAAA,WAA+CL,EAAA,QAAoBU,YAAA,iBAA2BP,EAAAE,GAAA,WAAAF,EAAAE,GAAA,gBAAAL,EAAA,QAAsDU,YAAA,kBAA4BP,EAAAE,GAAA,UAAAF,EAAAE,GAAA,WAAAL,EAAA,QAAgDU,YAAA,kBAA4BP,EAAAE,GAAA,UAAAF,EAAAE,GAAA,kDAAAL,EAAA,QAAuFU,YAAA,gBAA0BP,EAAAE,GAAA,yCAAAL,EAAA,QAA6DU,YAAA,eAAyBP,EAAAE,GAAA,YAAgBF,EAAAE,GAAA,OAAAF,EAAAE,GAAA,oBAAAL,EAAA,QAAyDU,YAAA,kBAA4BP,EAAAE,GAAA,KAAAL,EAAA,QAAyBU,YAAA,gBAA0BP,EAAAE,GAAA,cAAAF,EAAAE,GAAA,UAAAF,EAAAE,GAAA,oBAAkDL,EAAA,QAA4BU,YAAA,iBAA2BP,EAAAE,GAAA,QAAAF,EAAAE,GAAA,6BAAgCL,EAAA,QAAgCU,YAAA,kBAA4BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,SAAAL,EAAA,QAAiDU,YAAA,gBAA0BP,EAAAE,GAAA,oBAAAF,EAAAE,GAAA,wBAAuCL,EAAA,QAAgCU,YAAA,iBAA2BP,EAAAE,GAAA,YAAAF,EAAAE,GAAA,gBAAAL,EAAA,QAAuDU,YAAA,gBAA0BP,EAAAE,GAAA,SAAAF,EAAAE,GAAA,WAAAL,EAAA,QAA+CU,YAAA,gBAA0BP,EAAAE,GAAA,uBAAAF,EAAAE,GAAA,kCAAwDL,EAAA,QAA4BU,YAAA,iBAA2BP,EAAAE,GAAA,WAAAF,EAAAE,GAAA,oEAAAL,EAAA,QAA0GU,YAAA,kBAA4BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,SAAAL,EAAA,QAAiDU,YAAA,gBAA0BP,EAAAE,GAAA,sBAAAF,EAAAE,GAAA,yBAAmDL,EAAA,QAAuBU,YAAA,kBAA4BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,SAAAL,EAAA,QAAiDU,YAAA,gBAA0BP,EAAAE,GAAA,kCAAAF,EAAAE,GAAA,YAAuDL,EAAA,QAAkBU,YAAA,kBAA4BV,EAAA,QAAaU,YAAA,iBAA2BP,EAAAE,GAAA,cAAAF,EAAAE,GAAA,KAAAL,EAAA,QAA8CU,YAAA,eAAyBP,EAAAE,GAAA,WAAAF,EAAAE,GAAA,KAAAL,EAAA,QAA2CU,YAAA,gBAA0BP,EAAAE,GAAA,OAAAF,EAAAE,GAAA,WAAyBL,EAAA,QAAoBU,YAAA,kBAA4BP,EAAAE,GAAA,aAAAF,EAAAE,GAAA,SAAAL,EAAA,QAAiDU,YAAA,gBAA0BP,EAAAE,GAAA,uBAAAF,EAAAE,GAAA,uBAA4CL,EAAA,QAA6BU,YAAA,gBAA0BP,EAAAE,GAAA,YAAAF,EAAAE,GAAA,WAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,aAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,2UAAAL,EAAA,KAA6bM,OAAOC,KAAA,oDAAyDJ,EAAAE,GAAA,gDAAoDF,EAAAE,GAAA,8BAAAL,EAAA,KAAkDM,OAAOC,KAAA,oDAAyDJ,EAAAE,GAAA,gDAAoDF,EAAAE,GAAA,uMAAAL,EAAA,KAA2NM,OAAOC,KAAA,oDAAyDJ,EAAAE,GAAA,gDAAoDF,EAAAE,GAAA,iQAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,eAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,yCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,QAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,wMAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,UAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAA,EAAA,UAAAG,EAAAE,GAAA,mBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,sBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,aAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,oBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,mBAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAA,EAAA,UAAAG,EAAAE,GAAA,mBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,gBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,iBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,kBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,SAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,WAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,YAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAA,EAAA,UAAAG,EAAAE,GAAA,WAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,+EAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,yBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,UAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,0BAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,mCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,0BAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,wCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,yCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,2BAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,kDAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,qBAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,oCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,mDAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,4CAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,kBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,qDAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,oCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,4BAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,aAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,gCAAAF,EAAAE,GAAA,KAAAL,EAAA,KAAAG,EAAAE,GAAA,gBAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,uCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,kCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,2CAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,QAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,yEAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,oCAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,0EAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,+EAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAA,EAAA,MAAAG,EAAAE,GAAA,mEAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,2FAAAF,EAAAE,GAAA,KAAAL,EAAA,MAAAG,EAAAE,GAAA,iGCYjrOM,EAbyBC,EAAQ,OAajCC,CAXA,KAaElB,GATF,EAEA,KAEA,KAEA,MAUemB,EAAA,QAAAH,EAAiB,gCCtBhCI,EAAAC,QAAiBJ,EAAQ","file":"static/js/45.ab44e0c05dab1dc3c85c.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',[_c('p',[_vm._v(\"参考资料：\")]),_vm._v(\" \"),_c('p',[_c('a',{attrs:{\"href\":\"https://github.com/ccforward/cc/issues/47\"}},[_vm._v(\"44.理解事件循环一(浅析) · Issue #47 · ccforward/cc\")])]),_vm._v(\" \"),_c('p',[_c('a',{attrs:{\"href\":\"https://github.com/ccforward/cc/issues/48\"}},[_vm._v(\"45.理解事件循环二(macrotask和microtask) · Issue #48 · ccforward/cc\")])]),_vm._v(\" \"),_c('h1',[_vm._v(\"一、理解事件循环\")]),_vm._v(\" \"),_c('p',[_vm._v(\"1、栈stack与\")]),_vm._v(\" \"),_c('p',[_vm._v(\"当我们调用一个函数，它的地址、参数、局部变量都会压入到一个 stack 中\")]),_vm._v(\" \"),_c('p',[_vm._v(\"2、heap(堆)\")]),_vm._v(\" \"),_c('p',[_vm._v(\"当函数执行完毕后本地变量会从 stack 中弹出，这只有在使用 numbers string boolean 这种基本数据类型时才会发生。而对象、数组的值是存在于 heap(堆) 中的，stack 只存放了他们对应的指针。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"真正的值依然存在 heap 中，然后由垃圾回收器自动的清理回收。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"3、任务队列与事件循环\")]),_vm._v(\" \"),_c('p',[_vm._v(\"1、javascript 是单线程事件驱动的语言，那我们可以给时间添加监听器，当事件触发时，监听器就能执行回调函数。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"2、当我们去调用 \"),_c('code',[_vm._v(\"setTimeout\")]),_vm._v(\" \"),_c('code',[_vm._v(\"http.get\")]),_vm._v(\" \"),_c('code',[_vm._v(\"fs.readFile\")]),_vm._v(\", Node.js 会把这些定时器、http、IO操作\"),_c('strong',[_vm._v(\"发送给另一个线程\")]),_vm._v(\"以保证V8继续执行我们的代码。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"3、然而我们只有一个主线程和一个 call-stack ，这样当一个读取文件的操作还在执行时，有一个网络请求request过来，那这时他的回调就需要等stack变空才能执行。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"4、回调函数正在等待轮到自己执行所排的队就被称为任务队列(或者事件队列、消息队列)。每当主线程完成前一个任务，回调函数就会在一个无限循环圈里被调用，因此这个圈被称为事件循环。\")]),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"4、dom渲染和事件循环\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"执行栈中的同步代码执行完毕后，到进行下一轮事件循环之前，会尝试Dom渲染（如果没有dom操作，则不会渲染）\")]),_vm._v(\" \"),_c('p',[_vm._v(\"要测试这个过程，可以通过alert，alert会阻断dom渲染和js执行\")]),_vm._v(\" \"),_c('p',[_c('img',{attrs:{\"src\":\"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c0bbeff7-b4a8-4c65-a195-d4418d532878/Untitled.png\",\"alt\":\"Untitled\"}})]),_vm._v(\" \"),_c('p',[_vm._v(\"5、为什么微任务的执行时机比宏任务早？\")]),_vm._v(\" \"),_c('p',[_vm._v(\"因为微任务是在dom渲染前触发，宏任务在dom渲染后\")]),_vm._v(\" \"),_c('h1',[_vm._v(\"二、事件循环示例\")]),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"关键点：\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"到 \"),_c('a',{attrs:{\"href\":\"http://news-at.zhihu.com/api/4/news/$%7Baid%7D\"}},[_vm._v(\"http://news-at.zhihu.com/api/4/news/${aid}\")]),_vm._v(\" 的HTTP请求被发送到后台线程，然后函数\"),_c('strong',[_vm._v(\"继续往下\")]),_vm._v(\"执行，当后台线程返回之后，end事件的匿名回调函数被执行\")]),_vm._v(\" \"),_c('pre',[_c('code',{staticClass:\"language-jsx\"},[_c('span',{staticClass:\"hljs-meta\"},[_vm._v(\"'use strict'\")]),_vm._v(\"\\n\\n\"),_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"const\")]),_vm._v(\" express = \"),_c('span',{staticClass:\"hljs-built_in\"},[_vm._v(\"require\")]),_vm._v(\"(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'express'\")]),_vm._v(\")\\n\"),_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"const\")]),_vm._v(\" superagent = \"),_c('span',{staticClass:\"hljs-built_in\"},[_vm._v(\"require\")]),_vm._v(\"(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'superagent'\")]),_vm._v(\")\\n\"),_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"const\")]),_vm._v(\" app = express()\\n\\napp.get(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'/'\")]),_vm._v(\", getArticle)\\n\\n\"),_c('span',{staticClass:\"hljs-function\"},[_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"function\")]),_vm._v(\" \"),_c('span',{staticClass:\"hljs-title\"},[_vm._v(\"getArticle\")]),_vm._v(\"(\"),_c('span',{staticClass:\"hljs-params\"},[_vm._v(\"req, res\")]),_vm._v(\") \")]),_vm._v(\"{\\n    fetchArticle(req, res)\\n    print()\\n}\\n\\n\"),_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"const\")]),_vm._v(\" aids = [\"),_c('span',{staticClass:\"hljs-number\"},[_vm._v(\"4564824\")]),_vm._v(\", \"),_c('span',{staticClass:\"hljs-number\"},[_vm._v(\"4506868\")]),_vm._v(\", \"),_c('span',{staticClass:\"hljs-number\"},[_vm._v(\"4767667\")]),_vm._v(\", \"),_c('span',{staticClass:\"hljs-number\"},[_vm._v(\"4856099\")]),_vm._v(\", \"),_c('span',{staticClass:\"hljs-number\"},[_vm._v(\"7456996\")]),_vm._v(\"];\\n\\n\"),_c('span',{staticClass:\"hljs-function\"},[_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"function\")]),_vm._v(\" \"),_c('span',{staticClass:\"hljs-title\"},[_vm._v(\"fetchArticle\")]),_vm._v(\"(\"),_c('span',{staticClass:\"hljs-params\"},[_vm._v(\"req, res\")]),_vm._v(\") \")]),_vm._v(\"{\\n    \"),_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"const\")]),_vm._v(\" aid = aids[\"),_c('span',{staticClass:\"hljs-built_in\"},[_vm._v(\"Math\")]),_vm._v(\".floor(\"),_c('span',{staticClass:\"hljs-built_in\"},[_vm._v(\"Math\")]),_vm._v(\".random() * aids.length)]\\n    superagent.get(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"`http://news-at.zhihu.com/api/4/news/\"),_c('span',{staticClass:\"hljs-subst\"},[_vm._v(\"${aid}\")]),_vm._v(\"`\")]),_vm._v(\")\\n        .end(\"),_c('span',{staticClass:\"hljs-function\"},[_vm._v(\"(\"),_c('span',{staticClass:\"hljs-params\"},[_vm._v(\"err, res\")]),_vm._v(\") =>\")]),_vm._v(\" {\\n            \"),_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"if\")]),_vm._v(\"(err) {\\n                \"),_c('span',{staticClass:\"hljs-built_in\"},[_vm._v(\"console\")]),_vm._v(\".log(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'error ......'\")]),_vm._v(\");\\n                \"),_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"return\")]),_vm._v(\" res.status(\"),_c('span',{staticClass:\"hljs-number\"},[_vm._v(\"500\")]),_vm._v(\").send(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'an error ......'\")]),_vm._v(\")\\n            }\\n            \"),_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"const\")]),_vm._v(\" article = res.body\\n            res.send(article)\\n            \"),_c('span',{staticClass:\"hljs-built_in\"},[_vm._v(\"console\")]),_vm._v(\".log(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'Got an article'\")]),_vm._v(\")\\n        })\\n\\n    \"),_c('span',{staticClass:\"hljs-built_in\"},[_vm._v(\"console\")]),_vm._v(\".log(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'Now is fetching an article'\")]),_vm._v(\")\\n}\\n\\n\"),_c('span',{staticClass:\"hljs-function\"},[_c('span',{staticClass:\"hljs-keyword\"},[_vm._v(\"function\")]),_vm._v(\" \"),_c('span',{staticClass:\"hljs-title\"},[_vm._v(\"print\")]),_vm._v(\"(\"),_c('span',{staticClass:\"hljs-params\"}),_vm._v(\")\")]),_vm._v(\"{\\n    \"),_c('span',{staticClass:\"hljs-built_in\"},[_vm._v(\"console\")]),_vm._v(\".log(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'Print something'\")]),_vm._v(\")\\n}\\n\\napp.listen(\"),_c('span',{staticClass:\"hljs-string\"},[_vm._v(\"'5000'\")]),_vm._v(\")\\n\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"对应执行顺序：\")]),_vm._v(\" \"),_c('p',[_vm._v(\"1、express 给 request 事件注册了一个 handler，并且当请求到达路径 '/' 时来触发handler\\n2、调过各个函数并且在端口 5000 上启动监听\\n3、stack 为空，等待 request 事件触发\\n4、根据传入的请求，事件触发，express 调用之前提供的函数 getArticle\\n5、getArticle 压入(push) stack\\n6、fetchArticle 被调用 同时压入 stack\\n7、Math.floor 和 Math.random 被调用压入 stack 然后再 弹出(pop), 从 aids 里面取出的一个值被赋值给变量 aid\\n8、superagent.get 被执行，参数为 '\"),_c('a',{attrs:{\"href\":\"http://news-at.zhihu.com/api/4/news/$%7Baid%7D\"}},[_vm._v(\"http://news-at.zhihu.com/api/4/news/${aid}\")]),_vm._v(\"' ,并且回调函数注册给了 end 事件\\n9、到 \"),_c('a',{attrs:{\"href\":\"http://news-at.zhihu.com/api/4/news/$%7Baid%7D\"}},[_vm._v(\"http://news-at.zhihu.com/api/4/news/${aid}\")]),_vm._v(\" 的HTTP请求被发送到后台线程，然后函数继续往下执行\\n10、'Now is fetching an article' 打印在 console 中。 函数 fetchArticle 返回\\n11、print 函数被调用, 'Print something' 打印在 console 中\\n12、函数 getArticle 返回，并从 stack 中弹出， stack 为空\\n13、等待 \"),_c('a',{attrs:{\"href\":\"http://news-at.zhihu.com/api/4/news/$%7Baid%7D\"}},[_vm._v(\"http://news-at.zhihu.com/api/4/news/${aid}\")]),_vm._v(\" 发送相应信息\\n14、响应信息到达，end 事件被触发\\n15、注册给 end 事件的匿名回调函数被执行，这个匿名函数和他闭包中的所有变量压入 stack，这意味着这个匿名函数可以访问并修改 express, superagent, app, aids, req, res, aid 的值以及之前所有已经定义的函数\\n16、函数 res.send() 伴随着 200 或 500 的状态码被执行，但同时又被放入到后台线程中，因此 响应流 不会阻塞我们函数的执行。匿名函数也被 pop 出 stack。\")]),_vm._v(\" \"),_c('h1',[_vm._v(\"三、宏任务、微任务\")]),_vm._v(\" \"),_c('p',[_vm._v(\"任务队列不止一个，还有 microtasks 和 macrotasks\")]),_vm._v(\" \"),_c('h2',[_vm._v(\"概念\")]),_vm._v(\" \"),_c('p',[_vm._v(\"一个事件循环(EventLoop)中会有一个正在执行的任务(Task)，而这个任务就是从 macrotask 队列中来的。在whatwg规范中有 queue 就是任务队列。当这个 macrotask 执行结束后所有可用的 microtask 将会在同一个事件循环中执行，当这些 microtask 执行结束后还能继续添加 microtask 一直到真个 microtask 队列执行结束。\")]),_vm._v(\" \"),_c('h2',[_vm._v(\"具体实现\")]),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"microtasks:\")])]),_vm._v(\" \"),_c('ul',[_c('li',[_vm._v(\"process.nextTick\")]),_vm._v(\" \"),_c('li',[_vm._v(\"promise\")]),_vm._v(\" \"),_c('li',[_vm._v(\"Object.observe\")]),_vm._v(\" \"),_c('li',[_vm._v(\"async await\")])]),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"macrotasks:\")])]),_vm._v(\" \"),_c('ul',[_c('li',[_vm._v(\"setTimeout\")]),_vm._v(\" \"),_c('li',[_vm._v(\"setInterval\")]),_vm._v(\" \"),_c('li',[_vm._v(\"setImmediate\")]),_vm._v(\" \"),_c('li',[_vm._v(\"I/O\")]),_vm._v(\" \"),_c('li',[_vm._v(\"DOM事件\")]),_vm._v(\" \"),_c('li',[_vm._v(\"Ajax\")])]),_vm._v(\" \"),_c('h2',[_c('strong',[_vm._v(\"怎么用\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"基本来说，当我们想以同步的方式来处理异步任务时候就用 microtask（比如我们需要直接在某段代码后就去执行某个任务，就像Promise一样）。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"其他情况就直接用 macrotask。\")]),_vm._v(\" \"),_c('h2',[_vm._v(\"执行顺序\")]),_vm._v(\" \"),_c('p',[_vm._v(\"再来回顾下事件循环如何执行一个任务的流程\")]),_vm._v(\" \"),_c('p',[_vm._v(\"当执行栈(call stack)为空的时候，开始依次执行：\")]),_vm._v(\" \"),_c('ol',[_c('li',[_vm._v(\"把最早的任务(task A)放入任务队列\")]),_vm._v(\" \"),_c('li',[_vm._v(\"如果 task A 为null (那任务队列就是空)，直接跳到第6步\")]),_vm._v(\" \"),_c('li',[_vm._v(\"将 currently running task 设置为 task A\")]),_vm._v(\" \"),_c('li',[_vm._v(\"执行 task A (也就是执行回调函数)\")]),_vm._v(\" \"),_c('li',[_vm._v(\"将 currently running task 设置为 null 并移出 task A\")]),_vm._v(\" \"),_c('li',[_vm._v(\"执行 microtask 队列\\n\"),_c('ul',[_c('li',[_vm._v(\"a: 在 microtask 中选出最早的任务 task X\")]),_vm._v(\" \"),_c('li',[_vm._v(\"b: 如果 task X 为null (那 microtask 队列就是空)，直接跳到 g\")]),_vm._v(\" \"),_c('li',[_vm._v(\"c: 将 currently running task 设置为 task X\")]),_vm._v(\" \"),_c('li',[_vm._v(\"d: 执行 task X\")]),_vm._v(\" \"),_c('li',[_vm._v(\"e: 将 currently running task 设置为 null 并移出 task X\")]),_vm._v(\" \"),_c('li',[_vm._v(\"f: 在 microtask 中选出最早的任务 , 跳到 b\")]),_vm._v(\" \"),_c('li',[_vm._v(\"g: 结束 microtask 队列\")])])]),_vm._v(\" \"),_c('li',[_vm._v(\"跳到第一步\")])]),_vm._v(\" \"),_c('p',[_vm._v(\"上面就算是一个简单的 event-loop 执行模型\")]),_vm._v(\" \"),_c('p',[_vm._v(\"再简单点可以总结为：\")]),_vm._v(\" \"),_c('ol',[_c('li',[_vm._v(\"在 macrotask 队列中执行最早的那个 task ，然后移出\")]),_vm._v(\" \"),_c('li',[_vm._v(\"执行 microtask 队列中所有可用的任务，然后移出\")]),_vm._v(\" \"),_c('li',[_vm._v(\"下一个循环，执行下一个 macrotask 中的任务 (再跳到第2步)\")])]),_vm._v(\" \"),_c('h2',[_vm._v(\"其他\")]),_vm._v(\" \"),_c('ul',[_c('li',[_vm._v(\"当一个task(在 macrotask 队列中)正处于执行状态，也可能会有新的事件被注册，那就会有新的 task 被创建。比如下面两个\\n\"),_c('ol',[_c('li',[_vm._v(\"promiseA.then() 的回调就是一个 task\")])]),_vm._v(\" \"),_c('ul',[_c('li',[_vm._v(\"promiseA 是 resolved或rejected: 那这个 task 就会放入当前事件循环回合的 microtask queue\")]),_vm._v(\" \"),_c('li',[_vm._v(\"promiseA 是 pending: 这个 task 就会放入 事件循环的未来的某个(可能下一个)回合的 microtask queue 中\")])]),_vm._v(\" \"),_c('ol',[_c('li',[_vm._v(\"setTimeout 的回调也是个 task ，它会被放入 macrotask queue 即使是 0ms 的情况\")])])]),_vm._v(\" \"),_c('li',[_vm._v(\"microtask queue 中的 task 会在事件循环的当前回合中执行，因此 macrotask queue 中的 task 就只能等到事件循环的下一个回合中执行了\")]),_vm._v(\" \"),_c('li',[_vm._v(\"click ajax setTimeout 的回调是都是 task, 同时，包裹在一个 script 标签中的js代码也是一个 task 确切说是 macrotask。\")])])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7fc33808\",\"hasScoped\":false,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./node_modules/vue-markdown-loader/_cache/eventloop.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../vue-loader/lib/component-normalizer\")\n/* script */\nvar __vue_script__ = null\n/* template */\nimport __vue_template__ from \"!!../../vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7fc33808\\\",\\\"hasScoped\\\":false,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../vue-loader/lib/selector?type=template&index=0!./eventloop.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader!./node_modules/vue-markdown-loader/_cache/eventloop.vue\n// module id = null\n// module chunks = ","module.exports = require(\"!!vue-loader!../../../../node_modules/vue-markdown-loader/_cache/eventloop.vue\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/posts/js/eventloop.md\n// module id = i0a/\n// module chunks = 45"],"sourceRoot":""}