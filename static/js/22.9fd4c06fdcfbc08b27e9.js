webpackJsonp([22],{"1lSE":function(s,t,a){s.exports=a("2USG")},"2USG":function(s,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("section",[a("h2",[s._v("一、节流(throttle)与防抖（debounce）的含义")]),s._v(" "),a("p",[a("strong",[s._v("节流：")])]),s._v(" "),a("p",[s._v("指连续触发事件但是在 n 秒中只执行一次函数。即 2n 秒内执行 2 次，3n秒内执行3次... 。节流如字面意思，会稀释函数的执行频率。")]),s._v(" "),a("p",[s._v("使用场景：dom元素拖拽，搜索联想等等")]),s._v(" "),a("p",[a("strong",[s._v("防抖：")])]),s._v(" "),a("p",[s._v("连续的事件响应我们在n秒内只执行一次回调。如n秒内触发6次，只在最后一次再执行回调。")]),s._v(" "),a("p",[s._v("使用场景：文本输入验证")]),s._v(" "),a("h2",[s._v("二、简单实现")]),s._v(" "),a("h3",[s._v("节流：")]),s._v(" "),a("p",[s._v("setTimeout版本：")]),s._v(" "),a("pre",[a("code",{staticClass:"language-bash"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" throttle1(fn, "),a("span",{staticClass:"hljs-built_in"},[s._v("wait")]),s._v(") {\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("let")]),s._v(" timer = null;\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-title"},[s._v("function")])]),s._v(" () {\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (timer) {\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(";\n      }\n      timer = setTimeout(() => {\n        fn.apply(this, arguments);\n        timer = null; // 或者clearTimeout（timer)清空定时器\n      }, "),a("span",{staticClass:"hljs-built_in"},[s._v("wait")]),s._v(");\n    };\n  }\n")])]),s._v(" "),a("p",[s._v("定时器版本：")]),s._v(" "),a("pre",[a("code",{staticClass:"language-jsx"},[a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("throttle")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("fn,wait")]),s._v(")")]),s._v("{\n "),a("span",{staticClass:"hljs-comment"},[s._v("// 首先获取调用throttle时的一个时间戳作为触发时时间，实现用闭包保存 pre 变量。")]),s._v("\n "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" pre = "),a("span",{staticClass:"hljs-built_in"},[s._v("Date")]),s._v(".now();\n "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n     "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" now = "),a("span",{staticClass:"hljs-built_in"},[s._v("Date")]),s._v(".now(); \n     "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v("( now - pre >= wait){ "),a("span",{staticClass:"hljs-comment"},[s._v("// 当当前时间-出发时时间大于等待时间后，触发fn函数执行")]),s._v("\n         fn.apply("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(","),a("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n         pre = "),a("span",{staticClass:"hljs-built_in"},[s._v("Date")]),s._v(".now(); "),a("span",{staticClass:"hljs-comment"},[s._v("// 更新触发时间")]),s._v("\n     } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v("{\n      "),a("span",{staticClass:"hljs-comment"},[s._v("//让方法在脱离事件后也能执行一次")]),s._v("\n        timeout = setTimeout("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n           fn.apply("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),a("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(") \n        }, wait);\n     }\n  }\n}\n")])]),s._v(" "),a("pre",[a("code",[s._v("   由此可以实现，在wait时间范围内，只执行一次，下一个时间窗内，会再次触发。调用方式：比如在2秒后调用handleSth()方法： throttle(handleSth, 2000)\n")])]),s._v(" "),a("h3",[s._v("防抖：")]),s._v(" "),a("pre",[a("code",{staticClass:"language-jsx"},[a("span",{staticClass:"hljs-comment"},[s._v("// 1、非立即执行版：一开始不触发delay秒后才会执行")]),s._v("\n"),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("debounce")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("func, delay")]),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" timer = "),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(";\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n   clearTimeout(timer);\n   timer = setTimeout("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("()")]),s._v(" =>")]),s._v(" {\n    func.apply("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),a("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(")\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 具体分析可见：https://blog.csdn.net/weixin_44494811/article/details/103486637")]),s._v("\n   }, delay)\n  }\n}\n \n"),a("span",{staticClass:"hljs-comment"},[s._v("// 2、立即执行版：一开始就触发，后面再触发不执行，delay秒后可以再触发")]),s._v("\n"),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("debounce")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("func, delay")]),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" timer;\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n    clearTimeout(timer);\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" callNow = !timer\n    timer = setTimeout("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("()")]),s._v(" =>")]),s._v(" {\n      timer = "),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(";\n    }, delay)\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (callNow) {\n      func.apply("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),a("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n    }\n  }\n}\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 3、综合版")]),s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 合成版")]),s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("/**\n   * @desc 函数防抖\n   * @param func 目标函数\n   * @param wait 延迟执行毫秒数\n   * @param immediate true - 立即执行， false - 延迟执行\n   */")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("debounce")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("func, wait, immediate")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" timer;\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" context = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(",\n          args = "),a("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(";\n      "),a("span",{staticClass:"hljs-comment"},[s._v("// 根据immediate参数配置是否立即执行")]),s._v("\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (timer) clearTimeout(timer);\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (immediate) {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" callNow = !timer;\n        timer = setTimeout("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("()")]),s._v(" =>")]),s._v(" {\n          timer = "),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(";\n        }, wait);\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (callNow) func.apply(context, args);\n      } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n        timer  = setTimeout("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("()")]),s._v(" =>")]),s._v(" {\n          func.apply\n        }, wait)\n      }\n    }\n}\n")])]),s._v(" "),a("h3",[s._v("拓展延伸")]),s._v(" "),a("p",[s._v("以上涉及的函数设计和思想可参考更详细的分解："),a("a",{attrs:{href:"https://www.cnblogs.com/zhangycun/p/10949450.html"}},[s._v("节流函数的原理和设计")]),s._v("、"),a("a",{attrs:{href:"https://blog.csdn.net/qq_41293573/article/details/99330608"}},[s._v("关于闭包中变量的存储")])]),s._v(" "),a("h2",[s._v("三、Lodash源码中的实现")]),s._v(" "),a("p",[s._v("lodash库中关于节流函数的实现，比简单的方法要成熟得多，首先，1、对引入的函数方法增加了类型判断：typeof function, 对配置也增加了对象类型判断："),a("a",{attrs:{href:"https://github.com/Liusq-Cindy/lodash/blob/e0029485ab4d97adea0cb34292afb6700309cf16/isObject.js#L24"}},[s._v("isObject.js")]),s._v(" 2、对函数节流函数增加了更多的可配置化参数，比如设置个最长等待时间，不管如何先响应一次再防抖等等，避免用户看上次页面假死。")]),s._v(" "),a("h3",[s._v("1、节流：")]),s._v(" "),a("h3",[s._v("_.throttle(func, [wait=0], [options=])")]),s._v(" "),a("p",[a("strong",[s._v("参数")])]),s._v(" "),a("ol",[a("li",[a("code",[s._v("func")]),s._v(" "),a("em",[s._v("(Function)")]),s._v(": 要节流的函数。")]),s._v(" "),a("li",[a("code",[s._v("[wait=0]")]),s._v(" "),a("em",[s._v("(number)")]),s._v(": 需要节流的毫秒。")]),s._v(" "),a("li",[s._v("[options=] "),a("em",[s._v("(Object)")]),s._v(": 选项对象。")]),s._v(" "),a("li",[a("code",[s._v("[options.leading=true]")]),s._v(" "),a("em",[s._v("(boolean)")]),s._v(": 指定调用在节流开始前。")]),s._v(" "),a("li",[a("code",[s._v("[options.trailing=true]")]),s._v(" "),a("em",[s._v("(boolean)")]),s._v(": 指定调用在节流结束后。")])]),s._v(" "),a("p",[s._v("主方法如下：")]),s._v(" "),a("pre",[a("code",{staticClass:"language-jsx"},[a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("throttle")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("func, wait, options")]),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" leading = "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" trailing = "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v("\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 首先判断传入的func是否是function类型")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("typeof")]),s._v(" func !== "),a("span",{staticClass:"hljs-string"},[s._v("'function'")]),s._v(") {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("throw")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" "),a("span",{staticClass:"hljs-built_in"},[s._v("TypeError")]),s._v("("),a("span",{staticClass:"hljs-string"},[s._v("'Expected a function'")]),s._v(")\n  }\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 判断配置参数是否是对象，并转换options.leading的类型为boolean")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (isObject(options)) {\n    leading = "),a("span",{staticClass:"hljs-string"},[s._v("'leading'")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("in")]),s._v(" options ? !!options.leading : leading\n    trailing = "),a("span",{staticClass:"hljs-string"},[s._v("'trailing'")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("in")]),s._v(" options ? !!options.trailing : trailing\n  }\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 执行debouce方法，并传递参数")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" debounce(func, wait, {\n    leading,\n    trailing,\n    "),a("span",{staticClass:"hljs-string"},[s._v("'maxWait'")]),s._v(": wait\n  })\n}\n")])]),s._v(" "),a("h3",[s._v("2、防抖：")]),s._v(" "),a("h3",[s._v("_.debounce(func, [wait=0], [options=])#")]),s._v(" "),a("p",[a("strong",[s._v("参数")])]),s._v(" "),a("ol",[a("li",[a("code",[s._v("func")]),s._v(" "),a("em",[s._v("(Function)")]),s._v(": 要防抖动的函数。")]),s._v(" "),a("li",[a("code",[s._v("[wait=0]")]),s._v(" "),a("em",[s._v("(number)")]),s._v(": 需要延迟的毫秒数。")]),s._v(" "),a("li",[s._v("[options=] "),a("em",[s._v("(Object)")]),s._v(": 选项对象。")]),s._v(" "),a("li",[a("code",[s._v("[options.leading=false]")]),s._v(" "),a("em",[s._v("(boolean)")]),s._v(": 指定在延迟开始前调用。")]),s._v(" "),a("li",[a("code",[s._v("[options.maxWait]")]),s._v(" "),a("em",[s._v("(number)")]),s._v(": 设置 "),a("code",[s._v("func")]),s._v(" 允许被延迟的最大值。")]),s._v(" "),a("li",[a("code",[s._v("[options.trailing=true]")]),s._v(" "),a("em",[s._v("(boolean)")]),s._v(": 指定在延迟结束后调用。")])]),s._v(" "),a("p",[s._v("在lodash库中，对于节流和防抖的处理，核心内容是debouce方法，下面对这个debounce方法进行简单的分析")]),s._v(" "),a("h3",[s._v("可配置化的debounce方法")]),s._v(" "),a("pre",[a("code",{staticClass:"language-jsx"},[a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("debounce")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("func, wait, options")]),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" lastArgs,\n    lastThis,\n    maxWait, "),a("span",{staticClass:"hljs-comment"},[s._v("// 最大等待时间")]),s._v("\n    result, "),a("span",{staticClass:"hljs-comment"},[s._v("// 执行func")]),s._v("\n    timerId, "),a("span",{staticClass:"hljs-comment"},[s._v("// 定时器句柄")]),s._v("\n    lastCallTime "),a("span",{staticClass:"hljs-comment"},[s._v("// 上次触发的时间，比如不断scroll，为上次scroll的时间")]),s._v("\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" lastInvokeTime = "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(" "),a("span",{staticClass:"hljs-comment"},[s._v("// 上次执行func的时间")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" leading = "),a("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(" "),a("span",{staticClass:"hljs-comment"},[s._v("// 配置参数，是否第一次触发立即执行")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" maxing = "),a("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(" "),a("span",{staticClass:"hljs-comment"},[s._v("// 是否有最长等待时间")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" trailing = "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(" "),a("span",{staticClass:"hljs-comment"},[s._v("// 是否在等待周期结束后执行传入的func函数")]),s._v("\n\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 如果wait没传，调用window.requestAnimationFrame()")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" useRAF = (!wait && wait !== "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(" && "),a("span",{staticClass:"hljs-keyword"},[s._v("typeof")]),s._v(" root.requestAnimationFrame === "),a("span",{staticClass:"hljs-string"},[s._v("'function'")]),s._v(")\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 判断func是否是函数类型")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("typeof")]),s._v(" func !== "),a("span",{staticClass:"hljs-string"},[s._v("'function'")]),s._v(") {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("throw")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" "),a("span",{staticClass:"hljs-built_in"},[s._v("TypeError")]),s._v("("),a("span",{staticClass:"hljs-string"},[s._v("'Expected a function'")]),s._v(")\n  }\n\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 从传入的options中取出参数并做一些类型转换")]),s._v("\n  wait = +wait || "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (isObject(options)) {\n    leading = !!options.leading\n    maxing = "),a("span",{staticClass:"hljs-string"},[s._v("'maxWait'")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("in")]),s._v(" options\n    maxWait = maxing ? "),a("span",{staticClass:"hljs-built_in"},[s._v("Math")]),s._v(".max(+options.maxWait || "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(", wait) : maxWait\n    trailing = "),a("span",{staticClass:"hljs-string"},[s._v("'trailing'")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("in")]),s._v(" options ? !!options.trailing : trailing\n  }\n\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 定义函数invokeFunc：用户传入的func方法的执行函数，传入参数time，并更新lastInvokeTime记录上次执行invokeFunc的时间")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("invokeFunc")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("time")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" args = lastArgs\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" thisArg = lastThis\n\n    lastArgs = lastThis = "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v("\n    lastInvokeTime = time\n    result = func.apply(thisArg, args)\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" result\n  }\n\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 定义函数startTimer： 创建一个定时器，传参pendingFunc待执行函数，wait延迟多久后执行")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("startTimer")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("pendingFunc, wait")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (useRAF) {\n      root.cancelAnimationFrame(timerId)\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" root.requestAnimationFrame(pendingFunc)\n    }\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" setTimeout(pendingFunc, wait)\n  }\n\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 定义函数cancelTimer： 清除创建的这个定时器：id句柄")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("cancelTimer")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("id")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (useRAF) {\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" root.cancelAnimationFrame(id)\n    }\n    clearTimeout(id)\n  }\n\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 定义leadingEdge：防抖开始执行的函数，根据leading判断，如果true,立即执行")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("leadingEdge")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("time")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 开始执行，则记录这个time为上次执行func的时间：lastInvokeTime")]),s._v("\n    lastInvokeTime = time\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 开始创建定时器执行")]),s._v("\n    timerId = startTimer(timerExpired, wait)\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 根据leading参数判断是否立即执行")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" leading ? invokeFunc(time) : result\n  }\n\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 根据传入的time,计算还需要等待的时间")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("remainingWait")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("time")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" timeSinceLastCall = time - lastCallTime "),a("span",{staticClass:"hljs-comment"},[s._v("// 现在距离上次触发scroll的时间")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" timeSinceLastInvoke = time - lastInvokeTime "),a("span",{staticClass:"hljs-comment"},[s._v("// 现在距离上次执行func的时间")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" timeWaiting = wait - timeSinceLastCall "),a("span",{staticClass:"hljs-comment"},[s._v("// wait延迟时间 - 距离上次触发scroll的时间")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" maxing\n      ? "),a("span",{staticClass:"hljs-built_in"},[s._v("Math")]),s._v(".min(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting \n\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 如果设置了最大等待时间，则还需等待：（延迟时间wait - 已经等候时间，最大等待时间-上次执行func剩余的时间）两者取较小值")]),s._v("\n\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 否则，还需等待 wait - 已经等候时间")]),s._v("\n  }\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 根据传入的time判断是否应该执行func函数")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("shouldInvoke")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("time")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" timeSinceLastCall = time - lastCallTime "),a("span",{staticClass:"hljs-comment"},[s._v("// 上次触发")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" timeSinceLastInvoke = time - lastInvokeTime "),a("span",{staticClass:"hljs-comment"},[s._v("// 上次执行")]),s._v("\n\n   "),a("span",{staticClass:"hljs-comment"},[s._v("// 四种情况执行：")]),s._v("\n\t\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 1、第一次触发，lastCallTime为undefined")]),s._v("\n\t\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 2、距离上次触发已经大于延迟时间了")]),s._v("\n\t\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 3、当前-上次触发<0,特殊情况，比如原本是2020，修改了系统时间为2018")]),s._v("\n\t\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 4、距离上次执行的时间> 最长等待时间了")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" (lastCallTime === "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v(" || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(") || (maxing && timeSinceLastInvoke >= maxWait))\n  }\n\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 防抖核心，判断是执行函数，还是继续设置定时器")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("timerExpired")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" time = "),a("span",{staticClass:"hljs-built_in"},[s._v("Date")]),s._v(".now()\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (shouldInvoke(time)) { "),a("span",{staticClass:"hljs-comment"},[s._v("// 根据当前时间，判断是否应该执行，如果是，执行func")]),s._v("\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" trailingEdge(time)\n    }\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 否则，重置定时器，将剩余的时间传入")]),s._v("\n    timerId = startTimer(timerExpired, remainingWait(time))\n  }\n\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 执行func的判断函数")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("trailingEdge")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("time")]),s._v(") ")]),s._v("{\n    timerId = "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v("\n\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// Only invoke if we have `lastArgs` which means `func` has been")]),s._v("\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// debounced at least once.")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (trailing && lastArgs) {\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" invokeFunc(time)\n    }\n    lastArgs = lastThis = "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" result\n  }\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 取消防抖")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("cancel")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (timerId !== "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v(") {\n      cancelTimer(timerId)\n    }\n    lastInvokeTime = "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("\n    lastArgs = lastCallTime = lastThis = timerId = "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v("\n  }\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 直接执行")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("flush")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" timerId === "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v(" ? result : trailingEdge("),a("span",{staticClass:"hljs-built_in"},[s._v("Date")]),s._v(".now())\n  }\n\n\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 判断是否在等待中")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("pending")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" timerId !== "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v("\n  }\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 入口函数")]),s._v("\n  "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("debounced")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("...args")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" time = "),a("span",{staticClass:"hljs-built_in"},[s._v("Date")]),s._v(".now()\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" isInvoking = shouldInvoke(time) "),a("span",{staticClass:"hljs-comment"},[s._v("// 根据当前时间判断是否应该执行func函数")]),s._v("\n\n    lastArgs = args\n    lastThis = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("\n    lastCallTime = time\n\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (isInvoking) {\n\t\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 如果定时器还未创建，创建定时器按照所设置的是否立即执行去执行")]),s._v("\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (timerId === "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v(") {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" leadingEdge(lastCallTime)\n      }\n\t\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 如果设置了最长等待时间，创建定时器，返回func的执行方法")]),s._v("\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (maxing) {\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// Handle invocations in a tight loop.")]),s._v("\n        timerId = startTimer(timerExpired, wait)\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" invokeFunc(lastCallTime)\n      }\n    }\n\t\t"),a("span",{staticClass:"hljs-comment"},[s._v("// 如果还没有创建定时器，创建定时器")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (timerId === "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v(") {\n      timerId = startTimer(timerExpired, wait)\n    }\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" result\n  }\n  debounced.cancel = cancel\n  debounced.flush = flush\n  debounced.pending = pending\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" debounced\n}\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" debounce\n")])]),s._v(" "),a("p",[s._v("基于以上debounce的基础，其实lodash中，对节流的的实现，就是传了一个maxWait参数（ "),a("code",[s._v("func")]),s._v(" 允许被延迟的最大值）为wait （延迟数），它的结果是如果连续不断触发则每隔 wait 秒执行一次func。")]),s._v(" "),a("p",[s._v("参考文章："),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/38313717"}},[s._v("防抖和节流概念理解—timeline图")]),s._v("、"),a("a",{attrs:{href:"https://blog.csdn.net/weixin_33701564/article/details/88703489?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-8.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-8.control"}},[s._v("lodash源码赏析")])])])}]},l=a("VU/8")(null,n,!1,null,null,null);t.default=l.exports}});
//# sourceMappingURL=22.9fd4c06fdcfbc08b27e9.js.map